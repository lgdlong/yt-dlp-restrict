<!-- FILE: index.html -->
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yt‑dlp Command Builder — cookies.txt & MP3</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>yt‑dlp Command Builder — tải video giới hạn độ tuổi (cookies.txt) & MP3 nhiều chất lượng</h1>
        <p class="lead">Sinh lệnh cho Windows PowerShell hoặc Bash. Mặc định dùng <b>cookies.txt</b> để vượt hạn chế tuổi, trích MP3 theo bitrate mong muốn.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card full">
        <div class="grid">
          <div class="full">
            <label for="url">URL video / playlist</label>
            <div class="input-wrap">
              <input id="url" type="url" placeholder="https://www.youtube.com/watch?v=... hoặc https://www.youtube.com/playlist?list=..." required>
              <div class="input-ctrls">
                <button class="txt-btn" id="pasteUrl" title="Dán từ clipboard" aria-label="Dán URL">Dán</button>
                <button class="txt-btn" id="cleanUrl" title="Làm sạch tham số dư (chỉ giữ v hoặc list)" aria-label="Làm sạch URL">Làm sạch</button>
              </div>
            </div>
            <div id="urlWarning" class="warn" hidden></div>
            <div class="hint">Hỗ trợ cả video lẫn playlist. Nếu là playlist, bỏ chọn “Không tải playlist” ở dưới.</div>
          </div>

          <div class="full">
            <label for="cookies">Đường dẫn cookies.txt</label>
            <div class="input-wrap">
              <input id="cookies" type="text" placeholder="E:\ttt-patreon\cookies.txt" required>
              <div class="input-ctrls">
                <!-- <button class="txt-btn" id="pickCookies" title="Chọn file cookies.txt (mở File Picker)" aria-label="Chọn cookies.txt">Chọn file</button> -->
                <button class="txt-btn" id="pasteCookies" title="Dán đường dẫn từ clipboard" aria-label="Dán đường dẫn">Dán</button>
              </div>
            </div>
            <div class="hint">Xuất cookies bằng extension (Get cookies.txt). Lưu ý: Trình duyệt không cung cấp <i>đường dẫn tuyệt đối</i> qua File Picker — hãy dùng nút <b>Dán</b> nếu bạn đã “Copy as path” trong Explorer.</div>
          </div>

          <div>
            <label for="outdir">Thư mục lưu (-P)</label>
            <div class="input-wrap">
              <input id="outdir" type="text" placeholder="E:\ttt-patreon">
              <div class="input-ctrls">
                <!-- <button class="txt-btn" id="pickOutdir" title="Chọn thư mục lưu (mở Folder Picker)" aria-label="Chọn thư mục">Chọn thư mục</button> -->
                <button class="txt-btn" id="pasteOutdir" title="Dán đường dẫn từ clipboard" aria-label="Dán đường dẫn">Dán</button>
              </div>
            </div>
          </div>
          <div>
            <label for="shell">Kiểu shell</label>
            <select id="shell">
              <option value="powershell">Windows PowerShell</option>
              <option value="bash">Bash / WSL / macOS / Linux</option>
            </select>
            <div class="hint">Tự đổi ký tự xuống dòng: PowerShell dùng backtick <code>`</code>, Bash dùng <code>\</code>.</div>
          </div>

          <div class="full">
            <label>Chất lượng MP3 (--audio-quality)</label>
            <div id="aq" class="radio-group"><!-- pills injected by JS --></div>
            <div class="hint">0 ≈ 320 kbps (cao nhất) · 5 ≈ 160 kbps · 6 ≈ 128 kbps · 7 ≈ 112 kbps · 9 ≈ 64 kbps (nhẹ nhất)</div>
          </div>

          <div class="full">
            <label>Tùy chọn</label>
            <div class="row">
              <label class="pill"><input type="checkbox" id="embedThumb" checked> Nhúng thumbnail</label>
              <label class="pill"><input type="checkbox" id="embedMeta" checked> Nhúng metadata</label>
              <label class="pill"><input type="checkbox" id="noPlaylist"> Không tải playlist (--no-playlist)</label>
            </div>
          </div>

          <div class="full">
            <label for="archive">Bỏ qua video đã tải trước đó (--download-archive)</label>
            <input id="archive" type="text" placeholder="E:\ttt-patreon\archive.txt">
          </div>

          <div class="full">
            <label for="template">Mẫu tên file (-o)</label>
            <div class="input-wrap">
              <input id="template" type="text" placeholder="%(title)s [%(id)s].%(ext)s">
              <div class="input-ctrls">
                <button class="txt-btn" type="button" id="presetSimple"   title="Đơn giản">Đơn giản</button>
                <button class="txt-btn" type="button" id="presetUploader" title="Uploader + Title">Uploader + Title</button>
                <button class="txt-btn" type="button" id="presetTitleDate"title="Title [UploadDate]">Title [UploadDate]</button>
                <button class="txt-btn" type="button" id="presetDated"    title="Có ngày đăng + ID">Ngày + ID</button>
                <button class="txt-btn" type="button" id="presetPlaylist" title="Playlist (thư mục + số thứ tự)">Playlist</button>
              </div>
            </div>
            <details class="hint" style="margin-top:8px;">
              <summary>Gợi ý biến đặt tên</summary>
              <div class="hint" style="margin-top:8px">
                <code>%(title)s</code>, <code>%(uploader)s</code>, <code>%(id)s</code>, <code>%(upload_date>%Y-%m-%d)s</code>, <code>%(playlist_title)s</code>, <code>%(playlist_index)03d</code>
              </div>
            </details>
          </div>
        </div>

        <div class="row" style="margin-top:12px; gap:8px;">
          <button id="gen" class="btn primary" type="button">Sinh lệnh</button>
          <button id="copy" class="btn" type="button">Sao chép</button>
          <button id="reset" class="btn" type="button">Đặt lại</button>
          <span class="hint" id="status"></span>
        </div>
      </div>

      <div class="card full">
        <label>Kết quả</label>
        <pre><code id="output"># Lệnh sẽ xuất hiện ở đây…</code></pre>
        <footer>
          Cần <b>FFmpeg</b> trong PATH để chuyển sang MP3 & nhúng thumbnail/metadata. Trên Windows: <code>winget install -e --id Gyan.FFmpeg</code>
        </footer>
      </div>

      <div class="card full">
        <details>
          <summary><b>Mẹo & xử lý sự cố cookies.txt</b></summary>
          <ul>
            <li>Cookies phải export khi đang đăng nhập vào <code>youtube.com</code> bằng tài khoản đã xác minh tuổi.</li>
            <li>Nếu gặp lỗi đăng nhập tuổi, hãy export lại cookies mới; cookie có hạn.</li>
            <li>Không dùng <code>--no-playlist</code> nếu bạn nhập URL playlist và muốn tải toàn bộ.</li>
            <li>Dùng <code>--download-archive</code> để tránh tải trùng lần sau.</li>
          </ul>
        </details>
      </div>
    </div>

    <footer class="wrap" style="margin-top:22px;">
      <span class="muted">© 2025 — yt‑dlp command helper. Dùng cho mục đích hợp pháp / cá nhân.</span>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>